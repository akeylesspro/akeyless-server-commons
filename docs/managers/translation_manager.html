<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>src/managers/translation_manager.ts</title>
    <link rel="stylesheet" href="../styles.css" />
  </head>
  <body>
    <div class="content">
    <h1>src/managers/translation_manager.ts</h1>
    
    <h2>Purpose</h2>
    <p>Singleton translation manager providing cached translation lookups for UI messages, SMS messages, and email content. Supports multiple languages and scopes with fallback to key names when translations are missing.</p>

    <h2>Dependencies</h2>
    <ul>
      <li>Types from <a href="../types/index.html"><code>src/types</code></a>:
        <ul>
          <li><code>EntityOptions</code> - Entity type enumeration</li>
          <li><code>LangOptions</code> - Language enumeration</li>
        </ul>
      </li>
      <li><code>TObject</code> from <code>akeyless-types-commons</code> - Generic object type</li>
    </ul>

    <h2>Data Structure</h2>
    <p>Translations are stored in a nested object structure:</p>
    <pre><code>{
  [scope: string]: {
    [lang: string]: {
      [key: string]: string; // Translation value
    };
  };
}</code></pre>
    <p><strong>Key Format:</strong> Translation keys use double underscore (<code>__</code>) separator: <code>{entity}__{key}</code></p>

    <h2>Exports and behavior</h2>
    
    <h3><code>TranslationManager</code> Class</h3>
    <ul>
      <li><code>getInstance(): TranslationManager</code> - Returns the singleton instance</li>
      <li><code>setTranslationData(data: TObject&lt;any&gt;): void</code> - Sets the translation data cache (typically called during snapshot initialization)</li>
      <li><code>getTranslationData(): TObject&lt;any&gt;</code> - Retrieves the entire translation data cache</li>
      <li><code>get_translation(scope: string, lang: string, entity: string, key: string): string</code> - Retrieves a translation from the cache
        <ul>
          <li>Constructs lookup key: <code>{entity}{entity ? "__" : ""}{key}</code></li>
          <li>Returns translation if found, otherwise returns lookup key as fallback</li>
        </ul>
      </li>
      <li><code>get_sms(lang: LangOptions, entity: EntityOptions, key: string): string</code> - Retrieves an SMS translation
        <ul>
          <li>Looks up in <code>data["sms"]</code> scope</li>
          <li>Returns <code>"N/A"</code> if lookup fails</li>
        </ul>
      </li>
      <li><code>get_email(lang: LangOptions, entity: EntityOptions, key: string): string</code> - Retrieves an email translation
        <ul>
          <li>Looks up in <code>data["email"]</code> scope</li>
          <li>Returns <code>"N/A"</code> if lookup fails</li>
        </ul>
      </li>
    </ul>

    <h3><code>translation_manager: TranslationManager</code></h3>
    <p>Exported singleton instance for direct use.</p>

    <h2>Translation Population</h2>
    <p>Translations are populated by:</p>
    <ol>
      <li><strong>Firebase Snapshot</strong> - <code>nx-translations</code> collection loaded on startup</li>
      <li><strong>Snapshot Parsers</strong> - <code>parse_add_update_translations</code> updates cache</li>
      <li><strong>Manual Updates</strong> - <code>setTranslationData()</code> can be called directly</li>
    </ol>

    <h2>Context</h2>
    <p>The translation manager provides:</p>
    <ul>
      <li><strong>Multi-language Support</strong> - Supports multiple languages</li>
      <li><strong>Scoped Translations</strong> - Organizes translations by scope</li>
      <li><strong>Fallback Handling</strong> - Returns key if translation missing</li>
      <li><strong>Cached Access</strong> - Fast in-memory lookups</li>
      <li><strong>Type Safety</strong> - Uses enums for language and entity types</li>
    </ul>
    </div>
  </body>
</html>
