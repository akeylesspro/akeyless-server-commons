{
  "metadata": {
    "source_file": "src/helpers/redis/snapshot.ts",
    "path": "docs/helpers/redis/snapshot.md",
    "type": "module"
  },
  "purpose": "Consume Redis Pub/Sub updates and hydrate cache using Redis data, with automatic fallback to Firebase snapshots when Redis is unavailable or unsupported. Provides the same cache parsing interface as Firebase snapshots, allowing seamless switching between data sources.",
  "dependencies": [
    "get_redis_commander, get_redis_listener, connection flags - Redis helpers",
    "snapshot, parsers, get_nx_settings - Firebase snapshot helpers",
    "get_collection_keys, scan_redis_keys - Key utilities",
    "logger - Logging manager",
    "Timestamp - Firestore timestamp",
    "CollectionConfig, RedisUpdatePayload, RedisUpdateType, TObject from akeyless-types-commons"
  ],
  "sections": [
    {
      "title": "Main Function",
      "exports": [
        {
          "name": "redis_snapshots_bulk",
          "signature": "redis_snapshots_bulk(configs: OnSnapshotConfig[]): Promise<void>",
          "type": "function",
          "description": "Orchestrates Redis snapshot subscriptions with validation and Firebase fallback.",
          "parameters": [
            {
              "name": "configs",
              "type": "OnSnapshotConfig[]",
              "description": "Array of snapshot configurations"
            }
          ],
          "returns": "Promise resolving when all snapshots are initialized",
          "behavior": [
            "First-Time Initialization: Validates each config via validate_config, If validation fails: Logs warning, Triggers Firebase snapshot if trigger_firebase_snapshot is true, Continues to next config, If validation succeeds: Calls parse_redis_snapshot for initial data load, Sets up Pub/Sub listener",
            "Update Subscription: Sets up pmessage listener on Redis listener client, Listens for pattern: get_collection_keys(REDIS_UPDATES_PREFIX), On message: Parses JSON payload, Extracts: collection_name, update_type, data, Finds relevant configs matching collection name, Calls parse_redis_snapshot with update data"
          ],
          "examples": [
            {
              "code": "await redis_snapshots_bulk([\n  {\n    collection_name: 'nx-users',\n    cache_name: 'users',\n    parse_as: 'object',\n    subscription_type: 'redis'\n  }\n]);",
              "language": "typescript"
            }
          ]
        }
      ]
    }
  ],
  "context": [
    "This module enables Redis as a live data source:",
    "Seamless Integration - Same interface as Firebase snapshots",
    "Automatic Fallback - Falls back to Firebase when Redis unavailable",
    "Real-time Updates - Pub/Sub for live cache updates",
    "Consistent Parsing - Uses same parsers as Firebase snapshots",
    "Configuration-Driven - Settings determine data source"
  ],
  "best_practices": [
    "Configure cache_collections_config in nx-settings",
    "Set sync_direction: \"firebase_to_redis\" for Redis snapshots",
    "Use subscription_type: \"redis\" in snapshot config",
    "Handle Redis unavailability gracefully (automatic fallback)",
    "Monitor subscription status for health checks"
  ]
}
